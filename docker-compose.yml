version: "3.3"

services:
  ui:
    ipc: host
    build:
      context: ./typescript
    env_file: .env
    ports:
      - "${UI_HOST_PORT}:${UI_CONT_PORT}"
    stdin_open: true
    tty: true
  vllm:
    ipc: host
    build:
      context: ./vllm
    env_file: .env
    ports:
      - "${VLLM_HOST_PORT}:${VLLM_CONT_PORT}"
    stdin_open: true
    tty: true
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              device_ids: ["0"]
              capabilities: [gpu]
  omnipedia:
    ipc: host
    build:
      context: ./rust
    env_file: .env
    ports:
      - "${OMNIPEDIA_HOST_PORT}:${OMNIPEDIA_CONT_PORT}"
    stdin_open: true
    tty: true
    volumes:
      - ./rust/db:/db
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              device_ids: ["0"]
              capabilities: [gpu]
  embeddings:
    ipc: host
    build:
      context: ./embeddings_service
    env_file: .env
    ports:
      - "${EMBED_HOST_PORT}:${EMBED_CONT_PORT}"
    stdin_open: true
    tty: true
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              device_ids: ["0"]
              capabilities: [gpu]
